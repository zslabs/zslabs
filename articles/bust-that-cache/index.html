<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Bust that cache - Zach Schnackel</title><script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=default,fetch,Number.isInteger"></script><link rel=stylesheet href=../../assets/css/site.css?1515464732000><link rel=alternate type=application/rss+xml name="Zach Schnackel" title="ZS Labs" href=../../rss.xml></head><body class=page-bust-that-cache><div style="border: 0px; clip: rect(0px 0px 0px 0px); height: 0px; overflow: hidden; padding: 0px; position: absolute; width: 0px"><svg width=1500 height=1000 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><pattern id=pattern x=0 y=0 width=1 height=1><image transform=scale(.25) x=-800 y=-575 width=1500 height=1000 xlink:href=../../assets/media/pattern.png /></pattern></defs><rect width=1500 height=1000 fill=url(#pattern)></rect></svg></div><div class="container u-posRelative" style="overflow: hidden"><header class=header><div><a href=../../ class="button--reset logo-interior"><i data-icon=logo class=icon-logo--small></i></a></div><div><a href=#articles class=articles-interiorTrigger data-offcanvas><i data-icon=list></i></a></div><div><a href=#aboutModal class="button--reset about-trigger" data-modal><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=../../assets/media/me.png alt="Zach Schnackel"></a><div id=aboutModal class="modal aboutModal" tabindex=-1 role=dialog aria-labelledby=aboutModal-title aria-describedby=aboutModal-desc><div class=modal-dialog><div class=modal-body><div class="u-flex u-flexEnd"><button class="button--reset modal-close" type=button data-modal-close><i data-icon=close></i></button></div><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=../../assets/media/me.png class=aboutModal-image alt="Zach Schnackel"><h2 id=aboutModal-title class=u-textCenter>Hi, I'm Zach.</h2><div id=aboutModal-desc><ul class="inline inline--center inline--largeAbout-social"><li><a class=social-codepen href=https://codepen.io/zslabs><i data-icon=codepen></i></a></li><li><a class=social-github href=https://github.com/zslabs><i data-icon=github></i></a></li><li><a class=social-twitter href=https://twitter.com/zslabs><i data-icon=twitter></i></a></li></ul><p class=u-mv--large>I create buttons, borders, and other groovy things at <a href=http://www.rhinogram.com class="u-textUnderline u-textDefault">Rhinogram</a>. My background involves pushing the limits of of what we can build on the backend and how we can experience it on the frontend. My passions are perfecting process and educating those around me.</p><div class="row row--largeGutter"><div class=column-6@medium><h4>Speaking/Consulting</h4><p>Have an event and/or consluting project you'd like me to be apart of? Awesome! <a href=mailto:info@zslabs.com>Let's chat</a>.</p></div><div class=column-6@medium><h4>How'd you build this site?!</h4><p>Because I love open-source&mdash;it's available for anyone to view. Find a bug? Report it! <a href=https://github.com/zslabs/zslabs.github.io>View source</a>.</p></div></div><div class="u-mt--xlarge u-textCenter"><span class=u-textMuted>Copyright &copy; 2018 Zach Schnackel. Penalty is</span> üî•</div></div></div></div></div></div></header><main class="section article-content"><div class="container container--small"><h1 class=article-title>Bust that cache</h1><div class="u-textMuted u-mb--large">Jun 8th, 2013</div><p>Let&#39;s setup a typical development scenario. You&#39;re being good lad/lass and developing locally. You&#39;re using a preprocessor like <a href=http://sass-lang.com>Sass</a> or <a href=http://lesscss.org>Less</a> and <a href=http://incident57.com/codekit/ >Codekit</a> or <a href=https://github.com/guard/guard>Guard</a> to compile your assets. You&#39;re even using version control and deploying to a staging server. First, <em>virtual high-five</em>. Having a development process like this is extremely helpful for making changes quickly and having an audit trail as your product/project matures.</p><p>Let&#39;s take it a step further and move to server optimizations. You&#39;ve been searching around the web and come across <a href=https://github.com/h5bp/server-configs>HTML5 Boilerplate&#39;s server config</a> drop-in. Awesome. You&#39;re now delivering your site to customers/clients while using modern-day compression techniques and all the other goodness it gives. Here&#39;s the problem. The client asks you to make a quick color change and while you see the change on your end - they don&#39;t. Now the typical response would be,</p><blockquote><p>Can you try to clear your cache?</p></blockquote><p>And let&#39;s even say they don&#39;t mind doing that. But have you ever thought about what that means when you&#39;re pushing out new versions of styles/scripts to a live site? Sure, you could adjust the <code>ExpiresByType text/css &quot;access plus 1 year&quot;</code> time to something more reasonable like <code>&quot;access plus 1 week&quot;</code>, which would expire the cache on the user&#39;s machine to a week instead of a year. And while this may be fine for small color changes, what if you&#39;ve actually done some bigger changes? Or have decided you don&#39;t want to tell the client to clear their cache every time you push out a new update? This just isn&#39;t very practical at its current state. Let&#39;s see what our options are:</p><h3 id=query-args>Query args</h3><p>Using PHP for example, you can get a file&#39;s modification date with the <a href=http://php.net/manual/en/function.filemtime.php><code>filemtime</code></a> function which takes one parameter - the file name in question. So what we could do is add that modification time as a query arg:</p><pre><code class=language-php>&#39;assets/css/app.css?version=&#39; . date(&quot;Ymdhis&quot;, filemtime(&#39;assets/css/app.css&#39;) )
</code></pre><p>What we&#39;ve also done above is format the date that is returned using the <a href=http://php.net/manual/en/function.date.php><code>date</code></a> function. This will give us something like <code>/assets/css/app.css?version=20130608103339</code></p><p>This approach does have a drawback though: according to Google, <a href="https://developers.google.com/speed/docs/best-practices/caching?hl=sv#LeverageProxyCaching">most proxies don‚Äôt cache URLs with a query string</a>:</p><blockquote><p>Most proxies, most notably Squid up through version 3.0, do not cache resources with a &quot;?&quot; in their URL even if a Cache-control: public header is present in the response. To enable proxy caching for these resources, remove query strings from references to static resources, and instead encode the parameters into the file names themselves.</p></blockquote><h3 id=url-rewrites>URL rewrites</h3><p>From what we learned above, the next best option would be to rewrite the asset URL as something like <code>/assets/css/app.20130608103339.css</code></p><p>by using the following:</p><pre><code class=language-php>&#39;assets/css/app.&#39; . date(&quot;Ymdhis&quot;, filemtime(&#39;assets/css/app.css&#39;) ) . &#39;.css&#39;
</code></pre><p>Big problemo though, <code>app.20130608103339.css</code> doesn&#39;t exist on your server. In-fact, your server might even laugh at your if you try to access this directly.</p><p>Here it comes: let&#39;s rewrite that URL using <code>.htaccess</code>:</p><pre><code class=language-apache>RewriteRule ^assets/(css|js)/(.*)\.([0-9]+)\.(css|js)$ assets/$1/$2.$4 [L,NC]
</code></pre><p>What the above does it parse out each <em>chunk</em> within our asset URL and when that URL pattern is accessed, it simply redirects the user to the <em>normal</em> URL. So, what you may see on the frontend is <code>app.20130608103339.css</code>, but what is actually being interpreted is <code>app.css</code>. Win. <em>I&#39;m using this technique on my site as we speak (erm, read).</em></p><p>If you&#39;re using SSI, you could go about the rewrite in a similar fashion:</p><pre><code class=language-markup>&lt;!--#config timefmt=&quot;%Y%m%d%H%M%S&quot; --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/app.&lt;!--#flastmod virtual=&quot;/assets/css/app.css&quot; --&gt;.css&quot;&gt;
</code></pre><p>If you&#39;re using WordPress, I wrote a plugin in tandem with <a href=http://w-shadow.com>W-Shadow</a> called <a href=http://wordpress.org/plugins/versionit>VersionIt</a> which does this automagically for you.</p><p>Now there are certainly other options, like generating a MD5 hash with something like <a href=https://github.com/felthy/grunt-cachebuster>grunt-cachebuster</a>, but this is a great practice nonetheless while developing and deploying new versions of assets. Now go get &#39;em!</p><p>Props to <a href=https://twitter.com/weezer311>Brian Dadin</a>, for hammering this out with me.</p><hr class=u-mv--large><div id=disqus_thread><button type=button class="button button--comments button--fullWidth" data-js=loadComments>View Comments</button></div><script type=text/javascript>var disqus_shortname  = 'zslabs';
        var disqus_title      = 'Bust that cache';
        var disqus_identifier = '/articles/bust-that-cache';
        var disqus_url        = 'https://zslabs.com/articles/bust-that-cache';</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main></div><aside id=articles class=offCanvas tabindex=-1 role=dialog aria-labelledby=articles-title><div class=offCanvas-panel><button class="button--reset offCanvas-close" type=button data-offcanvas-close><i data-icon=close></i></button><h2 class=article-title>Articles</h2><ul class=articles-list><li><a class=u-inlineBlock href=../../articles/i-‚ù§Ô∏è-loaders/ ><div class="u-textLarge articles-title">I ‚ù§Ô∏è loaders</div><span class=u-textMuted>Mar 25th, 2017</span></a></li><li><a class=u-inlineBlock href=../../articles/onward-and-upward/ ><div class="u-textLarge articles-title">Onward and upward</div><span class=u-textMuted>Jan 21st, 2017</span></a></li><li><a class=u-inlineBlock href=../../articles/round-n-round/ ><div class="u-textLarge articles-title">Round &#39;n round</div><span class=u-textMuted>Jan 8th, 2017</span></a></li><li><a class=u-inlineBlock href=../../articles/gsap/ ><div class="u-textLarge articles-title">GSAP&#39;in</div><span class=u-textMuted>Jan 5th, 2017</span></a></li><li><a class=u-inlineBlock href=../../articles/polyno/ ><div class="u-textLarge articles-title">PolyNo?</div><span class=u-textMuted>Nov 15th, 2015</span></a></li><li><a class=u-inlineBlock href=../../articles/boomqueries/ ><div class="u-textLarge articles-title">BoomQueries - Element Queries, today</div><span class=u-textMuted>Apr 24th, 2015</span></a></li><li><a class=u-inlineBlock href=../../articles/svg-cool-kids/ ><div class="u-textLarge articles-title">Reference SVGs like the cool kids</div><span class=u-textMuted>Oct 14th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/svg-background-fill/ ><div class="u-textLarge articles-title">Modifying SVG background fills</div><span class=u-textMuted>Sep 29th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/do-more-with-less/ ><div class="u-textLarge articles-title">Do more with Less</div><span class=u-textMuted>Aug 14th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/sass-smartypants/ ><div class="u-textLarge articles-title">Sass tips for the wise and extremely good-looking</div><span class=u-textMuted>May 20th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/grunt-all-the-things/ ><div class="u-textLarge articles-title">Grunt all the things</div><span class=u-textMuted>Apr 21st, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/basey/ ><div class="u-textLarge articles-title">Basey - WordPress boilerplate theme</div><span class=u-textMuted>Mar 25th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/less-is-more/ ><div class="u-textLarge articles-title">Less is more</div><span class=u-textMuted>Mar 9th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/support-the-unsupported/ ><div class="u-textLarge articles-title">Support the unsupported</div><span class=u-textMuted>Feb 24th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/furry-sassy/ ><div class="u-textLarge articles-title">Fury &amp; Sassy</div><span class=u-textMuted>Jan 29th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/new-guts/ ><div class="u-textLarge articles-title">New guts</div><span class=u-textMuted>Jan 20th, 2014</span></a></li><li><a class=u-inlineBlock href=../../articles/pluggable-selectors/ ><div class="u-textLarge articles-title">Pluggable selectors - Sass vs Less</div><span class=u-textMuted>Sep 1st, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/accessing-external-wordpress-data/ ><div class="u-textLarge articles-title">Accessing external WordPress data</div><span class=u-textMuted>Jun 30th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/bust-that-cache/ ><div class="u-textLarge articles-title">Bust that cache</div><span class=u-textMuted>Jun 8th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/upgraded-yeti/ ><div class="u-textLarge articles-title">Upgraded Yeti</div><span class=u-textMuted>Apr 21st, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/versioned-dependencies-with-compass/ ><div class="u-textLarge articles-title">Versioned dependencies with Compass</div><span class=u-textMuted>Mar 31st, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/rethinking-the-wordpress-admin/ ><div class="u-textLarge articles-title">Rethinking the WordPress admin</div><span class=u-textMuted>Mar 16th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/default-views-for-plugins/ ><div class="u-textLarge articles-title">Default views for plugins</div><span class=u-textMuted>Mar 9th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/separating-form-and-function/ ><div class="u-textLarge articles-title">Separating form and function</div><span class=u-textMuted>Feb 20th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/extendable-switch-statements/ ><div class="u-textLarge articles-title">Extendable switch statements</div><span class=u-textMuted>Feb 9th, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/journey-to-sublime/ ><div class="u-textLarge articles-title">Journey to Sublime</div><span class=u-textMuted>Feb 2nd, 2013</span></a></li><li><a class=u-inlineBlock href=../../articles/hello-kirby/ ><div class="u-textLarge articles-title">Hello Kirby</div><span class=u-textMuted>Jan 28th, 2013</span></a></li></ul></div></aside><script src=../../assets/js/site.js?1515464706000></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-17637644-1', 'auto');
      ga('send', 'pageview');</script></body></html>